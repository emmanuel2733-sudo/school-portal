<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Bulk Import to CBT</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <style>
    :root {
      --primary: #6366f1;
      --success: #10b981;
      --danger: #e74a3b;
      --card-bg: #f8fafc;
    }
    body {
      background: #f1f5f9;
      font-family: 'Segoe UI', sans-serif;
      padding: 25px;
    }
    .container-box {
      max-width: 1000px;
      margin: auto;
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }
    .question-card {
      background: var(--card-bg);
      border: 1px solid #e2e8f0;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    .header-title {
      font-size: 1.9rem;
      font-weight: 800;
      color: #1e293b;
    }
    .btn-import {
      background: var(--success);
      color: white;
      padding: 12px 22px;
      border-radius: 8px;
      font-weight: 600;
      border: none;
    }
    .btn-import:hover {
      background: #0da271;
    }
    .back-btn {
      background: var(--primary);
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      text-decoration: none;
    }
  </style>
</head>
<body>

<div class="container-box">

  <a class="back-btn mb-3 d-inline-block" href="/teacher/question-bank/<%= course_id %>/<%= class_id %>/questions">
    <i class="fas fa-arrow-left"></i> Back
  </a>

  <h2 class="header-title">Bulk Import Questions to CBT</h2>
  <p>Select questions below and import them into a CBT exam.</p>

  <!-- Select Exam -->
  <label class="mt-2"><strong>Select Exam:</strong></label>
  <select id="examSelect" class="form-select mb-3">
    <option value="">Choose Exam</option>
    <% exams.forEach(ex => { %>
      <option value="<%= ex.id %>"><%= ex.title %> â€” <%= ex.class_name %></option>
    <% }) %>
  </select>

  <!-- Search -->
  <input type="text" id="searchBox" class="form-control mb-3" placeholder="Search questions...">

  <!-- Questions -->
  <% questions.forEach(q => { %>
    <div class="question-card question-item">
      <label style="width:100%;">
        <input type="checkbox" class="q-check" value="<%= q.id %>"
               style="transform:scale(1.3); margin-right:10px;">
        <strong><%= q.question %></strong>

        <div style="margin-top:10px; color:#475569;">
          A. <%= q.option1 %><br>
          B. <%= q.option2 %><br>
          C. <%= q.option3 %><br>
          D. <%= q.option4 %>
        </div>

        <% if (q.image_path) { %>
          <img src="/uploads/questions/<%= q.image_path %>"
               style="max-width:140px; border-radius:6px; margin-top:10px;">
        <% } %>
      </label>
    </div>
  <% }) %>

  <button id="importBtn" class="btn-import mt-3">
    <i class="fas fa-cloud-upload-alt"></i> Import Selected
  </button>

</div>


<script>
  // Search filter
  document.getElementById("searchBox").addEventListener("keyup", function() {
    let filter = this.value.toLowerCase();
    document.querySelectorAll(".question-item").forEach(item => {
      item.style.display = item.innerText.toLowerCase().includes(filter) ? "" : "none";
    });
  });

  // Import button
  document.getElementById("importBtn").addEventListener("click", () => {
    let examId = document.getElementById("examSelect").value;
    let selected = [...document.querySelectorAll(".q-check:checked")].map(cb => cb.value);

    if (!examId) return alert("Select an exam first.");
    if (selected.length === 0) return alert("Select at least one question.");

    // Send to backend
    fetch("/teacher/cbt/import/bulk", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        exam_id: examId,
        questions: JSON.stringify(selected)
      })
    })
    .then(res => res.json())
    .then(data => {
      alert("Imported: " + data.added + " questions!");
      window.location.href = "/teacher/cbt/" + examId + "/questions";
    })
    .catch(err => {
      console.error(err);
      alert("Error importing.");
    });
  });
</script>

</body>
</html>

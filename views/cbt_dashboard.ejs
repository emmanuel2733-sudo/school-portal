<!DOCTYPE html>
<html>
<head>
    <title>CBT – <%= course.course_name %></title>
    <link rel="stylesheet" href="/style.css">
    <style>
        body { font-family: Arial; background: #f5f5f5; padding: 30px; }
        .box { background: white; padding: 25px; border-radius: 10px; max-width: 900px; margin: auto; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        h1 { margin-top: 0; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align:left; }
        th { background: #f0f0f0; }
        .btn { padding: 8px 12px; border-radius: 5px; color: #fff; text-decoration: none; margin: 2px; display:inline-block; font-size: 0.9em; }
        .btn-primary { background: #007bff; }
        .btn-success { background: #28a745; }
        .btn-warning { background: #ffc107; color:#222; }
        .btn-danger { background: #dc3545; }
        .btn-secondary { background: #6c757d; }
    </style>
</head>

<body>
    <div class="box">

        <h1>CBT Management – <%= course.course_name %></h1>
        <p>
            <strong>Class:</strong> <%= course.class_name %> <br>
            <strong>Course ID:</strong> <%= course.course_id %>
        </p>

        <hr>

        <!-- CREATE EXAM BUTTON -->
        <a href="/admin/cbt/<%= course.course_id %>/create" class="btn btn-primary">
            + Create New Exam
        </a>

        <!-- SHOW EXAMS -->
        <% if (exams.length === 0) { %>

            <p style="margin-top:20px; background:#fff3cd; padding:10px; border-left:4px solid #ffecb5;">
                No CBT exams created for this course yet.
            </p>

        <% } else { %>
<table>
  <tr>
    <th>Exam Title</th>
    <th>Status</th>
    <th>Start</th>
    <th>End</th>
    <th>Enrolled</th>
    <th>Actions</th>
  </tr>

  <% exams.forEach(exam => { 
       const st = (exam.status || '').toString().trim().toLowerCase();
       const enrolled = (exam.enrolled_count || 0);
  %>
    <tr>
      <td><%= exam.title %></td>
      <td><%= exam.status || 'Unknown' %></td>
      <td><%= exam.start_time || 'Not set' %></td>
      <td><%= exam.end_time || 'Not set' %></td>

      <td>
        <%= enrolled %> student<%= enrolled == 1 ? '' : 's' %>
      </td>

      <td>
        <!-- EDIT (always visible so admin can change times/title) -->
        <a href="/admin/cbt/exam/<%= exam.id %>/edit" class="btn btn-warning">Edit</a>

        <!-- ENROLL -->
        <a href="/admin/cbt/<%= exam.id %>/enroll" class="btn btn-secondary">Enroll Students</a>

        <!-- VIEW QUESTIONS -->
        <a href="/admin/cbt/<%= exam.id %>/questions" class="btn btn-primary">Questions</a>

        <!-- PUBLISH (only when draft) -->
        <% if (st === 'draft') { %>
          <a href="/admin/cbt/<%= exam.id %>/publish" class="btn btn-success">Publish</a>
        <% } %>

        <!-- CLOSE (only when published) -->
        <% if (st === 'published') { %>
          <a href="/admin/cbt/<%= exam.id %>/close" class="btn btn-warning">Close</a>
        <% } %>

        <!-- RESULTS (only when closed) -->
        <% if (st === 'closed') { %>
          <a href="/admin/cbt/<%= exam.id %>/results" class="btn btn-primary">Results</a>
        <% } %>

        <!-- DELETE -->
        <a href="/admin/cbt/<%= exam.id %>/delete?courseId=<%= course.course_id %>"
   class="btn btn-danger"
   onclick="return confirm('Delete this exam? All questions & results will be removed.')">
   Delete
</a>

      </td>
    </tr>
  <% }) %>

</table>


        <% } %>

        <br>

        <a href="/admin/class/<%= course.class_id %>/courses?termId=1" class="btn btn-secondary">
            ⬅ Back to Courses
        </a>

    </div>
</body>
</html>
